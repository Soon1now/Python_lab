{% extends "teacher_panel/layout_teacher.html" %}

{% block title %}Мои задания - {{ user.get_full_name }}{% endblock %}

{% block content %}

<div class="container-fluid">
    <div class="row">
        <!-- Сайдбар -->
        <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'teacher_panel:dashboard' %}">
                            <i class="fas fa-book"></i> Мои курсы
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'teacher_panel:task' %}">
                            <i class="fas fa-check-circle"></i> Мои задания
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">

            <div class="row mb-4">
                <div class="col-md-4">
                    <select class="form-select" id="course-filter">
                        <option value="">Все курсы</option>
                        {% for course in courses %}
                        <option value="{{ course.id_course }}">{{ course.course_name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Таблица заданий -->
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>Название задания</th>
                            <th>Курс</th>
                            <th>Урок</th>>
                            <th>Дедлайн</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in tasks %}
                        <tr>
                            <td>{{ task.topic }}</td>
                            <td>{{ task.id_lesson.id_course.course_name }}</td>
                            <td>{{ task.id_lesson.topic }}</td>
                            <td>{{ task.due_date}}</td>
                            <td>
                                <div class="btn-group">
                                    <a href="#" class="btn btn-sm btn-primary">
                                        <i class="fas fa-edit"></i> Редактировать
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center">У вас пока нет заданий</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </main>
    </div>
</div>

<!-- JavaScript для фильтрации -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const courseFilter = document.getElementById('course-filter');
        const statusFilter = document.getElementById('status-filter');
        const tableRows = document.querySelectorAll('tbody tr');

        function filterTable() {
            const courseId = courseFilter.value;
            const status = statusFilter.value;

            tableRows.forEach(row => {
                const rowCourseId = row.querySelector('td:nth-child(2)').textContent;
                const rowStatus = row.querySelector('td:nth-child(4)').textContent.toLowerCase();

                const showRow = (!courseId || rowCourseId === courseId) &&
                    (!status || (status === 'active' ? rowStatus === 'активно' : rowStatus === 'неактивно'));

                row.style.display = showRow ? '' : 'none';
            });
        }

        courseFilter.addEventListener('change', filterTable);
        statusFilter.addEventListener('change', filterTable);
    });
</script>
{% endblock %}